
Работа со временем и временными метками

Данный файл описывает соглашения по работе со временем в FFCairo и avc_server

== Предпосылки ==

NOTE:
  Доподлино всех предпосылок мне не известно, если кто знает и может хорошо
  рассказать - напишите на zolotov-alex@shamangrad.net

FFmpeg в качестве меток времени использует арифметику дробных чисел. Для
каждого потока определяется time_base - минимальная единица измерения времени.
Задается она в виде дроби num/den. На сколько я понимаю, авторы FFmpeg не сами
это придумали и подобная нотация используется в формате контейнеров и в
кодеках. Таким образом time_base является минимальным квантом времени который
может обработать контейнер/кодек/плеер.

Единого соглашения каким должен быть time_base нет, обычно он зависит от
частоты смены кадров или частоты дискретизации (от frame_rate/sample_rate).
В документации FFmpeg периодически имеются отсылки что time_base (для видео)
равен 1/frame_rate, однако на практике это не так, более того сам FFmpeg,
не полагается на time_base при определении frame_rate и вычисляет его прочитав
несколько фреймов из потока (делается это в функции avformat_find_stream_info().
Более того, time_base равный 1/frame_rate не всегда удобен, в частности бывают
случаи когда frame_rate непостоянный


== Политика проекта FFCairo ==

Чтобы упростить расчеты, единица измерений времени в FFCairo будет
фиксированной. На первое время, в качестве единицы измерения мы возьмем 1мс,
что соответствует time_base=1/1000. Однако это не означает что в выходных
потоках будет задаваться это же время.

time_base равный 1мс удобен как для вычислений, так и для понимания при
отладке и расчетах вручную.

Сервер видеоконференций и его сопуствующие утилиты будут отслеживать время
в данной единице измерения и по необходимости конвертировать в/из других
форматов.

Чтобы выделить семантику в названии идентификаторов будем использовать имена
вроде mts (милли timestamp), ms/msec (милли секунда) и т.п.
